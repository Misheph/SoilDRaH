---
title: "FIA Data"
author: "Ursa Pillay, Kathe Todd-Brown"
date: "April 2024"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{readTemplate Function}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo=TRUE, warning=FALSE, message=FALSE}

library(readr) # read in the csv tables
library(tibble) # use tibbles instead of a data frame
library(plyr) # transform a list into a data frame for the bind
library(dplyr) # work with data tables and pivots
library(tidyr)
library(ggplot2)
source("../R/readFIA.R", local = knitr::knit_global())

#locate the data locally
dataDir <- '~/Desktop/datasets/fia'
dataDir  <- '~/UFL Dropbox/Katherine Todd-Brown/Research/Datasets/FS_FIA'
dataAnnotations <- '../data/fia_annotations.csv'
```

```{r, warning=FALSE}
fia.ls <- readFIA(dataDir, annotationFilename = dataAnnotations, verbose = TRUE)
```

```{r}
soil_carbon.df <- fia.ls$longtable %>%
  filter(is_type == 'identifier' | 
           of_variable %in% c('Forest_floor_depth_avg', 'Litter_layer_depth_avg',
                              'Layer_type',
                              'Oven_dry_weight', 'Bulk_density',
                              'organic_carbon', 'carbon_fraction',
                              'inorganic_carbon')) %>%
  mutate(column_name = sprintf('%s.%s', of_variable, is_type),
         row_id = sprintf('%s.%s', table_id, row_number)) %>%
  select(row_id, column_name, with_entry) %>%
  pivot_wider(names_from = 'column_name', values_from = 'with_entry') %>%
  select(-row_id) %>%
  pivot_longer(cols = ! ends_with('identifier'), values_drop_na = TRUE) %>%
  pivot_wider()

#TODO Track down the layer type values and filter for only soil
```

- [] histogram for each numerical variable
- [] lat/lon map for locations

```{r}
ggplot(soil_carbon.df %>%
         mutate(organic_carbon = as.numeric(organic_carbon.value),
                bulk_density = as.numeric(Bulk_density.value))) +
  geom_point(aes(x=bulk_density, y = organic_carbon), alpha = 0.1) +
  scale_x_log10() 
```
